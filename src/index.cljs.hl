(page "index.html"
      (:require-macros [cljs.core.async.macros :refer [go]])
      (:require [cljs.core.async :refer [ chan <! >! timeout close!]]
                [ui.els :refer [transaction-list]]
                [ui.summaries :refer [summaries]]
                [csv.upload :as csv]
                [db.dao :as dao]))

;; channel-based architecture credits https://mrmcc3.github.io/post/csv-with-clojurescript/


;; placeholders for reading things from db
(defc transactions
  #{
        })
(defc tags
  #{
    {:key "BRGAS-ELECTRICITY" :tag "utilities"}
    {:key "HALIFAX" :tag "mortgage"}
    {:key "BRGAS-GAS" :tag "utilities"}
    {:key "ENFIELD" :tag "counciltax"}
    })
(defn fetch [x coll] (:tag (first (filter #(= (:key %) x) coll))))
(defc= tagged-txs (map #(assoc % :tag (fetch (:description %) tags)) transactions))
(defc= summed-txs [1 2 3])

(defn load [] (dao/load-into transactions))

(html
 (head
  (link :href "app.css" :rel "stylesheet" :type "text/css"))
 (body
  (h1 "Fin")
  (p "Choose a CSV file")
  (input :type "file" :accept ".csv" :change csv/put-upload)
  (button :click load "Read")

  (summaries :from summed-txs)
  (transaction-list :tagged-txs tagged-txs :tags tags)
  #_  (hr)
  #_  (h5 "DB + tags")
  #_  (tag-debug :from tagged-txs)
  #_  (hr)
  #_  (h5 "Tags")
  #_  (tag-debug :from tags)
  ))
